"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[574],{3336:function(t,o,e){e.r(o),e.d(o,{default:function(){return A}});var a=e(6768),s=e(4232),n=e(5130);const i={class:"conflict-container"},l={class:"filter-bar"},c=["onClick"],r={class:"conflict-list"},f={key:0,class:"summary-block"},d=["innerHTML"],u=["onClick"],h=["onClick"],p={key:0,class:"modal-overlay"},m={class:"modal-content"},k=["innerHTML"],v=["placeholder"],g=["value"],y=["placeholder"],C=["placeholder"],$={value:"Активен"},_={value:"Закрыт"},L={value:"Обострение"},b={class:"modal-actions"},w=["disabled"],E=["disabled"];function S(t,o,e,S,T,I){return(0,a.uX)(),(0,a.CE)("div",i,[(0,a.Lk)("h1",null,(0,s.v_)(t.$t("conflicts.title")),1),(0,a.Lk)("div",l,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(T.statuses,(t=>((0,a.uX)(),(0,a.CE)("button",{key:t,class:(0,s.C4)({active:T.filterStatus===t}),onClick:o=>T.filterStatus=t},(0,s.v_)(I.getStatusLabel(t)),11,c)))),128)),(0,a.Lk)("button",{onClick:o[0]||(o[0]=t=>I.openModal(null)),class:"add-btn"},"➕ "+(0,s.v_)(t.$t("conflicts.addConflict")),1)]),(0,a.Lk)("div",r,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(I.filteredConflicts,(o=>((0,a.uX)(),(0,a.CE)("div",{key:o.id,class:"conflict-card"},[(0,a.Lk)("h3",null,"🧠 "+(0,s.v_)(o.context.slice(0,100))+"...",1),(0,a.Lk)("p",null,"👥 "+(0,s.v_)(t.$t("conflicts.participants"))+": "+(0,s.v_)(I.getParticipantNames(o.participants)),1),(0,a.Lk)("p",null,"🎯 "+(0,s.v_)(t.$t("conflicts.goal"))+": "+(0,s.v_)(o.goal),1),(0,a.Lk)("p",null,[(0,a.eW)("📌 "+(0,s.v_)(t.$t("conflicts.status"))+": ",1),(0,a.Lk)("strong",null,(0,s.v_)(I.getStatusLabel(o.status)),1)]),o.ai_analysis?((0,a.uX)(),(0,a.CE)("div",f,[(0,a.Lk)("strong",null,"📝 "+(0,s.v_)(t.$t("conflicts.recommendations"))+":",1),(0,a.Lk)("p",{innerHTML:I.shortenAnalysis(o.ai_analysis)},null,8,d)])):(0,a.Q3)("",!0),(0,a.Lk)("button",{onClick:t=>I.openModal(o)},"✏️ "+(0,s.v_)(t.$t("conflicts.openOrEdit")),9,u),(0,a.Lk)("button",{class:"delete-btn",onClick:t=>I.deleteConflict(o.id)},"🗑",8,h)])))),128))]),T.showModal?((0,a.uX)(),(0,a.CE)("div",p,[(0,a.Lk)("div",m,[T.form.ai_response?((0,a.uX)(),(0,a.CE)("div",{key:0,class:"ai-analysis",innerHTML:T.form.ai_response},null,8,k)):(0,a.Q3)("",!0),(0,a.Lk)("h2",null,(0,s.v_)(T.form.id?t.$t("conflicts.editConflict"):t.$t("conflicts.addConflict")),1),(0,a.Lk)("label",null,(0,s.v_)(t.$t("conflicts.context")),1),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":o[1]||(o[1]=t=>T.form.context=t),rows:"3",placeholder:t.$t("conflicts.contextPlaceholder")},null,8,v),[[n.Jo,T.form.context]]),(0,a.Lk)("label",null,(0,s.v_)(t.$t("conflicts.participants")),1),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":o[2]||(o[2]=t=>T.form.participants=t),multiple:""},[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(T.employees,(t=>((0,a.uX)(),(0,a.CE)("option",{value:t.id,key:t.id},(0,s.v_)(t.name),9,g)))),128))],512),[[n.u1,T.form.participants]]),(0,a.Lk)("label",null,(0,s.v_)(t.$t("conflicts.actionsTaken")),1),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":o[3]||(o[3]=t=>T.form.actions_taken=t),rows:"3",placeholder:t.$t("conflicts.actionsTakenPlaceholder")},null,8,y),[[n.Jo,T.form.actions_taken]]),(0,a.Lk)("label",null,(0,s.v_)(t.$t("conflicts.goal")),1),(0,a.bo)((0,a.Lk)("textarea",{"onUpdate:modelValue":o[4]||(o[4]=t=>T.form.goal=t),rows:"3",placeholder:t.$t("conflicts.goalPlaceholder")},null,8,C),[[n.Jo,T.form.goal]]),(0,a.Lk)("label",null,(0,s.v_)(t.$t("conflicts.status")),1),(0,a.bo)((0,a.Lk)("select",{"onUpdate:modelValue":o[5]||(o[5]=t=>T.form.status=t)},[(0,a.Lk)("option",$,(0,s.v_)(t.$t("conflicts.active")),1),(0,a.Lk)("option",_,(0,s.v_)(t.$t("conflicts.closed")),1),(0,a.Lk)("option",L,(0,s.v_)(t.$t("conflicts.escalated")),1)],512),[[n.u1,T.form.status]]),(0,a.Lk)("div",b,[(0,a.Lk)("button",{class:"generate-btn",onClick:o[6]||(o[6]=(...t)=>I.submitConflict&&I.submitConflict(...t)),disabled:T.loading}," 💬 "+(0,s.v_)(T.loading?t.$t("conflicts.analyzing"):t.$t("conflicts.analyze")),9,w),T.form.id?((0,a.uX)(),(0,a.CE)("button",{key:0,class:"save-btn",onClick:o[7]||(o[7]=(...t)=>I.saveConflict&&I.saveConflict(...t)),disabled:T.saving}," 💾 "+(0,s.v_)(T.saving?t.$t("common.loading"):t.$t("common.save")),9,E)):(0,a.Q3)("",!0),(0,a.Lk)("button",{class:"modal-close",onClick:o[8]||(o[8]=t=>T.showModal=!1)},"✖")])])])):(0,a.Q3)("",!0)])}e(4114),e(8111),e(2489),e(1701);var T={data(){return{conflicts:[],employees:[],showModal:!1,saving:!1,loading:!1,filterStatus:"all",statuses:["all","active","closed","escalated"],form:{id:null,context:"",participants:[],actions_taken:"",goal:"",status:"active",ai_response:""}}},computed:{filteredConflicts(){return"all"===this.filterStatus?this.conflicts:this.conflicts.filter((t=>t.status===this.filterStatus))}},methods:{async fetchConflicts(){const t=localStorage.getItem("token");try{const o=await fetch("/api/conflicts",{headers:{Authorization:`Bearer ${t}`}}),e=o.headers.get("content-type");if(!o.ok||!e?.includes("application/json"))return void console.error(this.$t("console.loadingConflictsError"),await o.text());this.conflicts=await o.json()}catch(o){console.error(this.$t("console.loadingConflictsError"),o)}},async fetchEmployees(){const t=localStorage.getItem("token");try{const o=await fetch("/employees",{headers:{Authorization:`Bearer ${t}`}}),e=o.headers.get("content-type");if(!o.ok||!e?.includes("application/json"))return void console.error(this.$t("console.loadingEmployeesError"),await o.text());this.employees=await o.json()}catch(o){console.error(this.$t("console.loadingEmployeesError"),o)}},shortenAnalysis(t){const o=t.replace(/<[^>]+>/g,"");return o.slice(0,350)+"..."},getParticipantNames(t){try{const o=Array.isArray(t)?t:JSON.parse(t);return this.employees.filter((t=>o.includes(t.id))).map((t=>t.name)).join(", ")}catch(o){return"—"}},openModal(t){if(t){this.form={...t};try{this.form.participants=JSON.parse(t.participants||"[]")}catch{this.form.participants=[]}this.form.ai_response=t.ai_analysis||"",this.form.actions_taken=t.attempts||""}else this.form={id:null,context:"",participants:[],actions_taken:"",goal:"",status:"active",ai_response:""};this.showModal=!0},async deleteConflict(t){const o=localStorage.getItem("token");try{await fetch(`/api/conflict/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${o}`}}),await this.fetchConflicts()}catch(e){alert(this.$t("conflicts.deleteError")),console.error(e)}},async submitConflict(){this.loading=!0;const t=localStorage.getItem("token"),o={...this.form,participants:JSON.stringify(this.form.participants),attempts:this.form.actions_taken};delete o.actions_taken;const e=!!this.form.id,a=e?`/api/conflict/${this.form.id}`:"/api/conflicts",s=e?"PUT":"POST";try{const e=await fetch(a,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(o)}),n=await e.json();e.ok?(this.form.ai_response=n.analysis,await this.fetchConflicts()):alert(n.error||this.$t("conflicts.saveError"))}catch(n){console.error(n),alert(this.$t("conflicts.connectionError"))}finally{this.loading=!1}},async saveConflict(){this.saving=!0;const t=localStorage.getItem("token"),o={...this.form,participants:JSON.stringify(this.form.participants),attempts:this.form.actions_taken};delete o.actions_taken;try{const e=await fetch("/api/conflicts/save",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(o)}),a=await e.json();e.ok?(this.showModal=!1,await this.fetchConflicts()):alert(a.error||this.$t("conflicts.saveError"))}catch(e){alert(this.$t("conflicts.connectionError")),console.error(e)}finally{this.saving=!1}},getStatusLabel(t){const o={all:this.$t("common.all"),active:this.$t("conflicts.active"),closed:this.$t("conflicts.closed"),escalated:this.$t("conflicts.escalated")};return o[t]||t},async waitForTokenAndInit(){let t=10;while(!localStorage.getItem("token")&&t>0)await new Promise((t=>setTimeout(t,300))),t--;const o=localStorage.getItem("token");o?(await this.fetchConflicts(),await this.fetchEmployees()):this.$router.push("/login")}},mounted(){this.waitForTokenAndInit()}},I=e(1241);const x=(0,I.A)(T,[["render",S],["__scopeId","data-v-61581f48"]]);var A=x}}]);
//# sourceMappingURL=574.404b56bb.js.map