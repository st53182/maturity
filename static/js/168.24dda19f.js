"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[168],{3168:function(t,o,i){i.r(o),i.d(o,{default:function(){return I}});var e=i(6768),n=i(4232),s=i(5130);const l={class:"poker-wrapper"},a={class:"poker-title"},r={key:0,class:"card poker-card"},c={key:1,class:"card poker-card"},p={class:"joined-info"},d={class:"story-list"},h=["onClick"],u={class:"add-story"},y={key:0},k={class:"sp-buttons"},m=["onClick"],S={class:"participants-box"},v={key:0},f={key:1},w={key:1,class:"hints-box"};function C(t,o,i,C,P,b){return(0,e.uX)(),(0,e.CE)("div",l,[(0,e.Lk)("h1",a,"🃏 Planning Poker — Комната "+(0,n.v_)(P.roomId),1),P.joined?((0,e.uX)(),(0,e.CE)("div",c,[(0,e.Lk)("div",p,[o[9]||(o[9]=(0,e.eW)("👤 ")),(0,e.Lk)("strong",null,(0,n.v_)(P.name),1),(0,e.eW)(" ("+(0,n.v_)(P.role)+")",1)]),o[11]||(o[11]=(0,e.Lk)("h3",null,"📋 Задачи",-1)),(0,e.Lk)("ul",d,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(P.stories,(t=>((0,e.uX)(),(0,e.CE)("li",{key:t.id,class:(0,n.C4)({active:P.selectedStory&&P.selectedStory.id===t.id}),onClick:o=>b.selectStory(t)},(0,n.v_)(t.title),11,h)))),128))]),(0,e.Lk)("div",u,[(0,e.bo)((0,e.Lk)("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>P.newStoryTitle=t),placeholder:"Новая задача (заголовок)",class:"form-control"},null,512),[[s.Jo,P.newStoryTitle]]),(0,e.bo)((0,e.Lk)("textarea",{"onUpdate:modelValue":o[4]||(o[4]=t=>P.newStoryDescription=t),placeholder:"Описание (необязательно)",class:"form-control"},null,512),[[s.Jo,P.newStoryDescription]]),(0,e.Lk)("button",{class:"btn btn-blue",onClick:o[5]||(o[5]=(...t)=>b.addStory&&b.addStory(...t))},"➕ Добавить задачу")]),o[12]||(o[12]=(0,e.Lk)("hr",null,null,-1)),P.selectedStory?((0,e.uX)(),(0,e.CE)("div",y,[(0,e.Lk)("h2",null,"📌 Голосуем за: "+(0,n.v_)(P.selectedStory.title),1),(0,e.Lk)("div",k,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(P.storyPoints,(t=>((0,e.uX)(),(0,e.CE)("button",{key:t,onClick:o=>b.selectSP(t),class:(0,n.C4)(["sp-btn",{selected:P.selectedSP===t}])},(0,n.v_)(t),11,m)))),128))])])):(0,e.Q3)("",!0),(0,e.Lk)("div",S,[o[10]||(o[10]=(0,e.Lk)("h3",null,"👥 Участники",-1)),(0,e.Lk)("ul",null,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(P.participants,(t=>((0,e.uX)(),(0,e.CE)("li",{key:t.id},[(0,e.Lk)("strong",null,(0,n.v_)(t.name),1),(0,e.eW)(" ("+(0,n.v_)(t.role)+") — ",1),P.votesVisible?((0,e.uX)(),(0,e.CE)("span",v,(0,n.v_)(t.voted?t.points+" SP":"— ❌ Не голосовал"),1)):((0,e.uX)(),(0,e.CE)("span",f,(0,n.v_)(t.voted?"🔒 Оценка скрыта":"❌ Не голосовал"),1))])))),128))]),P.votesVisible?(0,e.Q3)("",!0):((0,e.uX)(),(0,e.CE)("button",{key:0,class:"btn btn-purple",onClick:o[6]||(o[6]=(...t)=>b.showVotes&&b.showVotes(...t))}," 👁 Показать оценки "))]),(0,e.Lk)("button",{class:"btn btn-red",onClick:o[7]||(o[7]=(...t)=>b.leaveRoom&&b.leaveRoom(...t))},"🚪 Выйти из комнаты"),P.hints.length?((0,e.uX)(),(0,e.CE)("div",w,[(0,e.Lk)("h3",null,"💡 Подсказки (оценка "+(0,n.v_)(P.selectedSP)+" SP):",1),(0,e.Lk)("ul",null,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(P.hints,((t,o)=>((0,e.uX)(),(0,e.CE)("li",{key:o},"— "+(0,n.v_)(t.story),1)))),128))])])):(0,e.Q3)("",!0)])):((0,e.uX)(),(0,e.CE)("div",r,[(0,e.bo)((0,e.Lk)("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>P.name=t),placeholder:"Ваше имя",class:"form-control"},null,512),[[s.Jo,P.name]]),(0,e.bo)((0,e.Lk)("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>P.role=t),class:"form-control"},o[8]||(o[8]=[(0,e.Lk)("option",{disabled:"",value:""},"Выберите роль",-1),(0,e.Lk)("option",null,"FE",-1),(0,e.Lk)("option",null,"BE",-1),(0,e.Lk)("option",null,"FullStack",-1),(0,e.Lk)("option",null,"QA",-1),(0,e.Lk)("option",null,"Analyst",-1)]),512),[[s.u1,P.role]]),(0,e.Lk)("button",{class:"btn btn-purple",onClick:o[2]||(o[2]=(...t)=>b.joinRoom&&b.joinRoom(...t))},"🚪 Присоединиться")]))])}i(4114);var P={data(){return{roomId:this.$route.params.roomId,name:"",role:"",joined:!1,participantId:null,storyPoints:[1,2,3,5,8,13,21],selectedSP:null,participants:[],votesVisible:!1,pollingInterval:null,stories:[],selectedStory:null,newStoryTitle:"",newStoryDescription:"",hints:[]}},mounted(){const t=localStorage.getItem("planningPokerParticipantId");t&&(this.participantId=t,this.joined=!0,this.fetchParticipants(),this.fetchCurrentStory(),this.startPolling())},methods:{async joinRoom(){const t=await fetch(`/api/planning-room/${this.roomId}/join`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.name,role:this.role})}),o=await t.json();this.participantId=o.participant_id,localStorage.setItem("planningPokerParticipantId",this.participantId),this.joined=!0,this.startPolling()},async fetchParticipants(){const t=await fetch(`/api/planning-room/${this.roomId}/participants`),o=await t.json();this.participants=o.participants,this.votesVisible=o.show_votes},async fetchStories(){const t=await fetch(`/api/planning-room/${this.roomId}/stories`),o=await t.json();this.stories=o.stories},async leaveRoom(){confirm("Вы уверены, что хотите покинуть комнату?")&&(await fetch(`/api/planning-room/${this.roomId}/leave/${this.participantId}`,{method:"POST"}),localStorage.removeItem("planningPokerParticipantId"),this.joined=!1,this.participantId=null,this.selectedStory=null,this.participants=[],this.stories=[],this.stopPolling())},async addStory(){if(!this.newStoryTitle)return alert("Введите заголовок задачи");const t=await fetch(`/api/planning-room/${this.roomId}/add-story`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:this.newStoryTitle,description:this.newStoryDescription})}),o=await t.json();this.stories.push(o),this.newStoryTitle="",this.newStoryDescription=""},async selectStory(t){this.selectedStory=t,await fetch(`/api/planning-room/${this.roomId}/current-story`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({story_id:t.id})})},async selectSP(t){this.selectedSP=t,await fetch(`/api/planning-room/${this.roomId}/vote`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({story_id:this.selectedStory.id,story_title:this.selectedStory.title,points:this.selectedSP,participant_id:this.participantId})}),this.fetchParticipants(),this.fetchHints(t)},async fetchHints(t){const o=await fetch(`/api/planning-room/${this.roomId}/hints?sp=${t}&role=${this.role}`),i=await o.json();this.hints=i.hints||[]},async fetchCurrentStory(){const t=await fetch(`/api/planning-room/${this.roomId}`);if(t.ok){const o=await t.json();this.selectedStory=o.current_story}},async showVotes(){await fetch(`/api/planning-room/${this.roomId}/show-votes`,{method:"POST"})},startPolling(){this.polling=setInterval((()=>{this.fetchParticipants(),this.fetchStories(),this.fetchCurrentStory()}),3e3)},stopPolling(){clearInterval(this.pollingInterval)}},beforeUnmount(){this.stopPolling()}},b=i(1241);const g=(0,b.A)(P,[["render",C]]);var I=g}}]);
//# sourceMappingURL=168.24dda19f.js.map