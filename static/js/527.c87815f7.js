"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[527],{3527:function(t,o,e){e.r(o),e.d(o,{default:function(){return g}});var i=e(6768),n=e(4232),s=e(5130);const l={class:"poker-wrapper"},a={class:"poker-title"},r={key:0,class:"card poker-card"},c={key:1,class:"card poker-card"},p={class:"joined-info"},d={class:"story-list"},h=["onClick"],u={class:"add-story"},y={key:0},k={class:"sp-buttons"},S=["onClick"],m={class:"participants-box"},v={key:0},f={key:1},w={key:1,class:"hints-box"};function b(t,o,e,b,C,P){return(0,i.uX)(),(0,i.CE)("div",l,[(0,i.Lk)("h1",a,"🃏 Planning Poker — Комната "+(0,n.v_)(C.roomId),1),C.joined?((0,i.uX)(),(0,i.CE)("div",c,[(0,i.Lk)("div",p,[o[8]||(o[8]=(0,i.eW)("👤 ")),(0,i.Lk)("strong",null,(0,n.v_)(C.name),1),(0,i.eW)(" ("+(0,n.v_)(C.role)+")",1)]),o[10]||(o[10]=(0,i.Lk)("h3",null,"📋 Задачи",-1)),(0,i.Lk)("ul",d,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(C.stories,(t=>((0,i.uX)(),(0,i.CE)("li",{key:t.id,class:(0,n.C4)({active:C.selectedStory&&C.selectedStory.id===t.id}),onClick:o=>P.selectStory(t)},(0,n.v_)(t.title),11,h)))),128))]),(0,i.Lk)("div",u,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>C.newStoryTitle=t),placeholder:"Новая задача (заголовок)",class:"form-control"},null,512),[[s.Jo,C.newStoryTitle]]),(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":o[4]||(o[4]=t=>C.newStoryDescription=t),placeholder:"Описание (необязательно)",class:"form-control"},null,512),[[s.Jo,C.newStoryDescription]]),(0,i.Lk)("button",{class:"btn btn-blue",onClick:o[5]||(o[5]=(...t)=>P.addStory&&P.addStory(...t))},"➕ Добавить задачу")]),o[11]||(o[11]=(0,i.Lk)("hr",null,null,-1)),C.selectedStory?((0,i.uX)(),(0,i.CE)("div",y,[(0,i.Lk)("h2",null,"📌 Голосуем за: "+(0,n.v_)(C.selectedStory.title),1),(0,i.Lk)("div",k,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(C.storyPoints,(t=>((0,i.uX)(),(0,i.CE)("button",{key:t,onClick:o=>P.selectSP(t),class:(0,n.C4)(["sp-btn",{selected:C.selectedSP===t}])},(0,n.v_)(t),11,S)))),128))])])):(0,i.Q3)("",!0),(0,i.Lk)("div",m,[o[9]||(o[9]=(0,i.Lk)("h3",null,"👥 Участники",-1)),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(C.participants,(t=>((0,i.uX)(),(0,i.CE)("li",{key:t.id},[(0,i.Lk)("strong",null,(0,n.v_)(t.name),1),(0,i.eW)(" ("+(0,n.v_)(t.role)+") — ",1),C.votesVisible?((0,i.uX)(),(0,i.CE)("span",v,(0,n.v_)(t.voted?t.points+" SP":"— ❌ Не голосовал"),1)):((0,i.uX)(),(0,i.CE)("span",f,(0,n.v_)(t.voted?"🔒 Оценка скрыта":"❌ Не голосовал"),1))])))),128))]),C.votesVisible?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("button",{key:0,class:"btn btn-purple",onClick:o[6]||(o[6]=(...t)=>P.showVotes&&P.showVotes(...t))}," 👁 Показать оценки "))]),C.hints.length?((0,i.uX)(),(0,i.CE)("div",w,[(0,i.Lk)("h3",null,"💡 Подсказки (оценка "+(0,n.v_)(C.selectedSP)+" SP):",1),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(C.hints,((t,o)=>((0,i.uX)(),(0,i.CE)("li",{key:o},"— "+(0,n.v_)(t.story),1)))),128))])])):(0,i.Q3)("",!0)])):((0,i.uX)(),(0,i.CE)("div",r,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>C.name=t),placeholder:"Ваше имя",class:"form-control"},null,512),[[s.Jo,C.name]]),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>C.role=t),class:"form-control"},o[7]||(o[7]=[(0,i.Lk)("option",{disabled:"",value:""},"Выберите роль",-1),(0,i.Lk)("option",null,"FE",-1),(0,i.Lk)("option",null,"BE",-1),(0,i.Lk)("option",null,"FullStack",-1),(0,i.Lk)("option",null,"QA",-1),(0,i.Lk)("option",null,"Analyst",-1)]),512),[[s.u1,C.role]]),(0,i.Lk)("button",{class:"btn btn-purple",onClick:o[2]||(o[2]=(...t)=>P.joinRoom&&P.joinRoom(...t))},"🚪 Присоединиться")]))])}e(4114);var C={data(){return{roomId:this.$route.params.roomId,name:"",role:"",joined:!1,participantId:null,storyPoints:[1,2,3,5,8,13,21],selectedSP:null,participants:[],votesVisible:!1,pollingInterval:null,stories:[],selectedStory:null,newStoryTitle:"",newStoryDescription:"",hints:[]}},mounted(){const t=localStorage.getItem("planningPokerParticipantId");t&&(this.participantId=t,this.joined=!0,this.startPolling())},methods:{async joinRoom(){const t=await fetch(`/api/planning-room/${this.roomId}/join`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.name,role:this.role})}),o=await t.json();this.participantId=o.participant_id,localStorage.setItem("planningPokerParticipantId",this.participantId),this.joined=!0,this.startPolling()},async fetchParticipants(){const t=await fetch(`/api/planning-room/${this.roomId}/participants`),o=await t.json();this.participants=o.participants,this.votesVisible=o.show_votes},async fetchStories(){const t=await fetch(`/api/planning-room/${this.roomId}/stories`),o=await t.json();this.stories=o.stories},async addStory(){if(!this.newStoryTitle)return alert("Введите заголовок задачи");const t=await fetch(`/api/planning-room/${this.roomId}/add-story`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:this.newStoryTitle,description:this.newStoryDescription})}),o=await t.json();this.stories.push(o),this.newStoryTitle="",this.newStoryDescription=""},selectStory(t){this.selectedStory=t,this.selectedSP=null,this.hints=[]},async selectSP(t){this.selectedSP=t,await fetch(`/api/planning-room/${this.roomId}/vote`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({story_id:this.selectedStory.id,story_title:this.selectedStory.title,points:this.selectedSP,participant_id:this.participantId})}),this.fetchParticipants(),this.fetchHints(t)},async fetchHints(t){const o=await fetch(`/api/planning-room/${this.roomId}/hints?sp=${t}&role=${this.role}`),e=await o.json();this.hints=e.hints||[]},async showVotes(){await fetch(`/api/planning-room/${this.roomId}/show-votes`,{method:"POST"})},startPolling(){this.pollingInterval=setInterval((()=>{this.fetchParticipants(),this.fetchStories()}),3e3)},stopPolling(){clearInterval(this.pollingInterval)}},beforeUnmount(){this.stopPolling()}},P=e(1241);const I=(0,P.A)(C,[["render",b]]);var g=I}}]);
//# sourceMappingURL=527.c87815f7.js.map