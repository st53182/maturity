"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[886],{1886:function(t,e,a){a.r(e),a.d(e,{default:function(){return b}});var o=a(6768),n=a(4232),l=a(5130);const s={class:"conflict-container"},i={class:"filter-bar"},c=["onClick"],r={class:"conflict-list"},u=["onClick"],f=["onClick"],d={key:0,class:"modal-overlay"},p={class:"modal-content"},k=["value"],m={class:"modal-actions"},h=["innerHTML"];function C(t,e,a,C,L,y){return(0,o.uX)(),(0,o.CE)("div",s,[e[15]||(e[15]=(0,o.Lk)("h1",null,"🔥 Конфликты в командах",-1)),(0,o.Lk)("div",i,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(L.statuses,(t=>((0,o.uX)(),(0,o.CE)("button",{key:t,class:(0,n.C4)({active:L.filterStatus===t}),onClick:e=>L.filterStatus=t},(0,n.v_)(t),11,c)))),128)),(0,o.Lk)("button",{onClick:e[0]||(e[0]=t=>y.openModal(null)),class:"add-btn"},"➕ Новый конфликт")]),(0,o.Lk)("div",r,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(y.filteredConflicts,(t=>((0,o.uX)(),(0,o.CE)("div",{key:t.id,class:"conflict-card"},[(0,o.Lk)("h3",null,"🧠 "+(0,n.v_)(t.context.slice(0,100))+"...",1),(0,o.Lk)("p",null,"👥 Участники: "+(0,n.v_)(y.getParticipantNames(t.participants)),1),(0,o.Lk)("p",null,"🎯 Цель: "+(0,n.v_)(t.goal),1),(0,o.Lk)("p",null,[e[8]||(e[8]=(0,o.eW)("📌 Статус: ")),(0,o.Lk)("strong",null,(0,n.v_)(t.status),1)]),(0,o.Lk)("button",{onClick:e=>y.openModal(t)},"✏️ Редактировать",8,u),(0,o.Lk)("button",{class:"delete-btn",onClick:e=>y.deleteConflict(t.id)},"🗑",8,f)])))),128))]),L.showModal?((0,o.uX)(),(0,o.CE)("div",d,[(0,o.Lk)("div",p,[(0,o.Lk)("h2",null,(0,n.v_)(L.form.id?"Редактировать":"Новый конфликт"),1),e[10]||(e[10]=(0,o.Lk)("label",null,"Контекст конфликта",-1)),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":e[1]||(e[1]=t=>L.form.context=t),rows:"3"},null,512),[[l.Jo,L.form.context]]),e[11]||(e[11]=(0,o.Lk)("label",null,"Участники",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>L.form.participants=t),multiple:""},[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(L.employees,(t=>((0,o.uX)(),(0,o.CE)("option",{value:t.id,key:t.id},(0,n.v_)(t.name),9,k)))),128))],512),[[l.u1,L.form.participants]]),e[12]||(e[12]=(0,o.Lk)("label",null,"Что предпринималось?",-1)),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":e[3]||(e[3]=t=>L.form.actions_taken=t),rows:"2"},null,512),[[l.Jo,L.form.actions_taken]]),e[13]||(e[13]=(0,o.Lk)("label",null,"Цель разрешения",-1)),(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":e[4]||(e[4]=t=>L.form.goal=t),rows:"2"},null,512),[[l.Jo,L.form.goal]]),e[14]||(e[14]=(0,o.Lk)("label",null,"Статус",-1)),(0,o.bo)((0,o.Lk)("select",{"onUpdate:modelValue":e[5]||(e[5]=t=>L.form.status=t)},e[9]||(e[9]=[(0,o.Lk)("option",{value:"Активен"},"Активен",-1),(0,o.Lk)("option",{value:"Закрыт"},"Закрыт",-1),(0,o.Lk)("option",{value:"Обострение"},"Обострение",-1)]),512),[[l.u1,L.form.status]]),(0,o.Lk)("div",m,[(0,o.Lk)("button",{onClick:e[6]||(e[6]=(...t)=>y.submitConflict&&y.submitConflict(...t))},"💬 Получить рекомендации"),(0,o.Lk)("button",{class:"modal-close",onClick:e[7]||(e[7]=t=>L.showModal=!1)},"✖")]),L.form.ai_response?((0,o.uX)(),(0,o.CE)("div",{key:0,class:"ai-analysis",innerHTML:L.form.ai_response},null,8,h)):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0)])}a(4114),a(8111),a(2489),a(1701);var L={data(){return{conflicts:[],employees:[],showModal:!1,filterStatus:"Все",statuses:["Все","Активен","Закрыт","Обострение"],form:{id:null,context:"",participants:[],actions_taken:"",goal:"",status:"Активен",ai_response:""}}},computed:{filteredConflicts(){return"Все"===this.filterStatus?this.conflicts:this.conflicts.filter((t=>t.status===this.filterStatus))}},methods:{async fetchConflicts(){const t=localStorage.getItem("token"),e=await fetch("/conflicts",{headers:{Authorization:`Bearer ${t}`}});this.conflicts=await e.json()},async fetchEmployees(){const t=localStorage.getItem("token"),e=await fetch("/employees",{headers:{Authorization:`Bearer ${t}`}});this.employees=await e.json()},getParticipantNames(t){try{const e=Array.isArray(t)?t:JSON.parse(t);return this.employees.filter((t=>e.includes(t.id))).map((t=>t.name)).join(", ")}catch(e){return"—"}},openModal(t){if(t){this.form={...t};try{this.form.participants=JSON.parse(t.participants||"[]")}catch(e){this.form.participants=[]}}else this.form={id:null,context:"",participants:[],actions_taken:"",goal:"",status:"Активен",ai_response:""};this.showModal=!0},async deleteConflict(t){const e=localStorage.getItem("token");await fetch(`/conflict/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`}}),await this.fetchConflicts()},async submitConflict(){const t=localStorage.getItem("token"),e={...this.form};e.participants=JSON.stringify(e.participants),e.attempts=e.actions_taken,delete e.actions_taken;const a=await fetch("/conflicts",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(e)}),o=await a.json();a.ok?(this.form.ai_response=o.analysis,await this.fetchConflicts()):alert(o.error||"Ошибка при сохранении конфликта")},async waitForTokenAndInit(){let t=10;while(!localStorage.getItem("token")&&t>0)await new Promise((t=>setTimeout(t,300))),t--;const e=localStorage.getItem("token");e?(await this.fetchConflicts(),await this.fetchEmployees()):this.$router.push("/login")}},mounted(){this.waitForTokenAndInit()}},y=a(1241);const v=(0,y.A)(L,[["render",C],["__scopeId","data-v-aa1ce97a"]]);var b=v}}]);
//# sourceMappingURL=886.52bf9f2d.js.map