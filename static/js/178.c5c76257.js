"use strict";(self["webpackChunkfrontend"]=self["webpackChunkfrontend"]||[]).push([[178],{1178:function(t,o,e){e.r(o),e.d(o,{default:function(){return j}});var i=e(6768),n=e(4232),s=e(5130);const l={class:"poker-wrapper"},a={class:"poker-title"},r={key:0,class:"card poker-card"},c=["placeholder"],p={disabled:"",value:""},d={key:1,class:"card poker-card"},h={class:"joined-info"},u={class:"story-list"},k=["onClick"],y={class:"add-story"},m=["placeholder"],v=["placeholder"],S={key:0},f={class:"sp-buttons"},w=["onClick"],C={class:"participants-box"},b={key:0},g={key:1},I={key:1,class:"hints-box"};function P(t,o,e,P,$,_){return(0,i.uX)(),(0,i.CE)("div",l,[(0,i.Lk)("h1",a,"🃏 "+(0,n.v_)(t.$t("poker.title"))+" — "+(0,n.v_)(t.$t("poker.room"))+" "+(0,n.v_)($.roomId),1),$.joined?((0,i.uX)(),(0,i.CE)("div",d,[(0,i.Lk)("div",h,[o[13]||(o[13]=(0,i.eW)("👤 ")),(0,i.Lk)("strong",null,(0,n.v_)($.name),1),(0,i.eW)(" ("+(0,n.v_)($.role)+")",1)]),(0,i.Lk)("h3",null,"📋 "+(0,n.v_)(t.$t("poker.tasks")),1),(0,i.Lk)("ul",u,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)($.stories,(t=>((0,i.uX)(),(0,i.CE)("li",{key:t.id,class:(0,n.C4)({active:$.selectedStory&&$.selectedStory.id===t.id}),onClick:o=>_.selectStory(t)},(0,n.v_)(t.title),11,k)))),128))]),(0,i.Lk)("div",y,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":o[3]||(o[3]=t=>$.newStoryTitle=t),placeholder:t.$t("poker.newTaskTitle"),class:"form-control"},null,8,m),[[s.Jo,$.newStoryTitle]]),(0,i.bo)((0,i.Lk)("textarea",{"onUpdate:modelValue":o[4]||(o[4]=t=>$.newStoryDescription=t),placeholder:t.$t("poker.descriptionOptional"),class:"form-control"},null,8,v),[[s.Jo,$.newStoryDescription]]),(0,i.Lk)("button",{class:"btn btn-blue",onClick:o[5]||(o[5]=(...t)=>_.addStory&&_.addStory(...t))},"➕ "+(0,n.v_)(t.$t("poker.addTask")),1)]),o[14]||(o[14]=(0,i.Lk)("hr",null,null,-1)),$.selectedStory?((0,i.uX)(),(0,i.CE)("div",S,[(0,i.Lk)("h2",null,"📌 "+(0,n.v_)(t.$t("poker.votingFor"))+": "+(0,n.v_)($.selectedStory.title),1),(0,i.Lk)("div",f,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)($.storyPoints,(t=>((0,i.uX)(),(0,i.CE)("button",{key:t,onClick:o=>_.selectSP(t),class:(0,n.C4)(["sp-btn",{selected:$.selectedSP===t}])},(0,n.v_)(t),11,w)))),128))])])):(0,i.Q3)("",!0),(0,i.Lk)("div",C,[(0,i.Lk)("h3",null,"👥 "+(0,n.v_)(t.$t("poker.participants")),1),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)($.participants,(o=>((0,i.uX)(),(0,i.CE)("li",{key:o.id},[(0,i.Lk)("strong",null,(0,n.v_)(o.name),1),(0,i.eW)(" ("+(0,n.v_)(o.role)+") — ",1),$.votesVisible?((0,i.uX)(),(0,i.CE)("span",b,(0,n.v_)(o.voted?o.points+" SP":"— ❌ "+t.$t("poker.didNotVote")),1)):((0,i.uX)(),(0,i.CE)("span",g,(0,n.v_)(o.voted?"🔒 "+t.$t("poker.voteHidden"):"❌ "+t.$t("poker.didNotVote")),1))])))),128))]),$.votesVisible?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("button",{key:0,class:"btn btn-purple",onClick:o[6]||(o[6]=(...t)=>_.showVotes&&_.showVotes(...t))}," 👁 "+(0,n.v_)(t.$t("poker.showVotes")),1))]),(0,i.Lk)("button",{class:"btn btn-red",onClick:o[7]||(o[7]=(...t)=>_.leaveRoom&&_.leaveRoom(...t))},"🚪 "+(0,n.v_)(t.$t("poker.leaveRoom")),1),$.hints.length?((0,i.uX)(),(0,i.CE)("div",I,[(0,i.Lk)("h3",null,"💡 Подсказки (оценка "+(0,n.v_)($.selectedSP)+" SP):",1),(0,i.Lk)("ul",null,[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)($.hints,((t,o)=>((0,i.uX)(),(0,i.CE)("li",{key:o},"— "+(0,n.v_)(t.story),1)))),128))])])):(0,i.Q3)("",!0)])):((0,i.uX)(),(0,i.CE)("div",r,[(0,i.bo)((0,i.Lk)("input",{"onUpdate:modelValue":o[0]||(o[0]=t=>$.name=t),placeholder:t.$t("poker.yourName"),class:"form-control"},null,8,c),[[s.Jo,$.name]]),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":o[1]||(o[1]=t=>$.role=t),class:"form-control"},[(0,i.Lk)("option",p,(0,n.v_)(t.$t("poker.selectRole")),1),o[8]||(o[8]=(0,i.Lk)("option",null,"FE",-1)),o[9]||(o[9]=(0,i.Lk)("option",null,"BE",-1)),o[10]||(o[10]=(0,i.Lk)("option",null,"FullStack",-1)),o[11]||(o[11]=(0,i.Lk)("option",null,"QA",-1)),o[12]||(o[12]=(0,i.Lk)("option",null,"Analyst",-1))],512),[[s.u1,$.role]]),(0,i.Lk)("button",{class:"btn btn-purple",onClick:o[2]||(o[2]=(...t)=>_.joinRoom&&_.joinRoom(...t))},"🚪 "+(0,n.v_)(t.$t("poker.join")),1)]))])}e(4114);var $={data(){return{roomId:this.$route.params.roomId,name:"",role:"",joined:!1,participantId:null,storyPoints:[1,2,3,5,8,13,21],selectedSP:null,participants:[],votesVisible:!1,pollingInterval:null,stories:[],selectedStory:null,newStoryTitle:"",newStoryDescription:"",hints:[]}},mounted(){const t=localStorage.getItem("planningPokerParticipantId");t&&(this.participantId=t,this.joined=!0,this.fetchParticipants(),this.fetchCurrentStory(),this.startPolling())},methods:{async joinRoom(){const t=await fetch(`/api/planning-room/${this.roomId}/join`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:this.name,role:this.role})}),o=await t.json();this.participantId=o.participant_id,localStorage.setItem("planningPokerParticipantId",this.participantId),this.joined=!0,this.startPolling()},async fetchParticipants(){const t=await fetch(`/api/planning-room/${this.roomId}/participants`),o=await t.json();this.participants=o.participants,this.votesVisible=o.show_votes},async fetchStories(){const t=await fetch(`/api/planning-room/${this.roomId}/stories`),o=await t.json();this.stories=o.stories},async leaveRoom(){confirm("Вы уверены, что хотите покинуть комнату?")&&(await fetch(`/api/planning-room/${this.roomId}/leave/${this.participantId}`,{method:"POST"}),localStorage.removeItem("planningPokerParticipantId"),this.joined=!1,this.participantId=null,this.selectedStory=null,this.participants=[],this.stories=[],this.stopPolling())},async addStory(){if(!this.newStoryTitle)return alert("Введите заголовок задачи");const t=await fetch(`/api/planning-room/${this.roomId}/add-story`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:this.newStoryTitle,description:this.newStoryDescription})}),o=await t.json();this.stories.push(o),this.newStoryTitle="",this.newStoryDescription=""},async selectStory(t){this.selectedStory=t,await fetch(`/api/planning-room/${this.roomId}/current-story`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({story_id:t.id})})},async selectSP(t){this.selectedSP=t,await fetch(`/api/planning-room/${this.roomId}/vote`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({story_id:this.selectedStory.id,story_title:this.selectedStory.title,points:this.selectedSP,participant_id:this.participantId})}),this.fetchParticipants(),this.fetchHints(t)},async fetchHints(t){const o=await fetch(`/api/planning-room/${this.roomId}/hints?sp=${t}&role=${this.role}`),e=await o.json();this.hints=e.hints||[]},async fetchCurrentStory(){const t=await fetch(`/api/planning-room/${this.roomId}`);if(t.ok){const o=await t.json();this.selectedStory=o.current_story}},async showVotes(){await fetch(`/api/planning-room/${this.roomId}/show-votes`,{method:"POST"})},startPolling(){this.polling=setInterval((()=>{this.fetchParticipants(),this.fetchStories(),this.fetchCurrentStory()}),3e3)},stopPolling(){clearInterval(this.pollingInterval)}},beforeUnmount(){this.stopPolling()}},_=e(1241);const L=(0,_.A)($,[["render",P]]);var j=L}}]);
//# sourceMappingURL=178.c5c76257.js.map